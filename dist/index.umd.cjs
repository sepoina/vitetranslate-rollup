(function(i,d){typeof exports=="object"&&typeof module<"u"?d(exports,require("path"),require("fs")):typeof define=="function"&&define.amd?define(["exports","path","fs"],d):(i=typeof globalThis<"u"?globalThis:i||self,d(i["@sepoina/vitetranslate-rollup"]={},i.path,i.fs))})(this,function(i,d,g){"use strict";function S(e){var a,t,r;if(((t=(a=e==null?void 0:e.container)==null?void 0:a.children)==null?void 0:t.length)===1){const n=e.container.children[0];return n.type==="JSXText"?n.value:n.type==="JSXExpressionContainer"&&((r=n==null?void 0:n.expression)!=null&&r.value)?n.expression.value:!1}return!1}function p(e,a){var r,n,o,l;const t=a.node.attributes.find(u=>{var c;return((c=u==null?void 0:u.name)==null?void 0:c.name)===e});return t?((r=t==null?void 0:t.value)==null?void 0:r.type)==="StringLiteral"?t.value.value:((n=t==null?void 0:t.value)==null?void 0:n.type)==="JSXExpressionContainer"&&((l=(o=t==null?void 0:t.value)==null?void 0:o.expression)==null?void 0:l.type)==="StringLiteral"?t.value.expression.value:!1:!1}function h(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var T={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),t.BASE=2166136261;function t(r,n=t.BASE){const o=r.length;for(let l=0;l<o;l++)n^=r.charCodeAt(l),n+=(n<<1)+(n<<4)+(n<<7)+(n<<8)+(n<<24);return n>>>0}a.default=t,e.exports=t})(T,T.exports);var x=T.exports;const m=h(x);function _(e,a){var n,o;if(!((n=e==null?void 0:e.node)!=null&&n.value)||!/_%_(.*?)_%_/.test(e.node.value))return;const t=(o=/_%_(.*?)_%_/.exec(e.node.value))==null?void 0:o[1];if(!t)return;const r=b(t,a);e.node.value=v(e.node.value,r,t),e.node.extra.rawValue&&(e.node.extra.rawValue=v(e.node.extra.rawValue,r,t)),e.node.extra.raw&&(e.node.extra.raw=v(e.node.extra.raw,r,t))}function v(e,a,t){const r=`_<_${a}_/_${t}_>_`;return e.replace(/_%_(.*?)_%_/,r)}function b(e,a){const t=d.parse(a.filename).name,r=m(e).toString(36),n=`${t}_${r}`;return globalThis.TranslateService.baseLng[n]=e,n}const y=e=>{const{types:a}=e;return{visitor:{StringLiteral:_,JSXText:_,TemplateElement:_,JSXOpeningElement(t,r){if(t.node.name.name!=="Translate"||t.node.attributes.find(s=>{var f;return((f=s==null?void 0:s.name)==null?void 0:f.name)==="data-translate"})||t.node.attributes.find(s=>(s==null?void 0:s.name.name)==="c"))return;const l=t.node.attributes.find(s=>{var f;return((f=s==null?void 0:s.name)==null?void 0:f.name)==="t"})?p("t",t):S(t);if(l===!1)throw"Errore, Translate deve contenere solo stringhe";const u=b(l,r),c=a.jSXAttribute(a.jSXIdentifier("data-translate"),a.stringLiteral(u));t.node.attributes.push(c)}}}};function E(e){return{name:"onRollupTranslate",buildStart:{sequential:!0,order:"pre",handler:()=>{globalThis.TranslateService=e,globalThis.TranslateService.baseLng={__lngVersion__:L()},console.log("Preparo il servizio traduzioni.")}},buildEnd:{sequential:!0,order:"post",handler:()=>{w()}}}}function w(){const e=globalThis.TranslateService.file,a=globalThis.TranslateService.dist;console.log("TRANSLATE ---------------------------------------------"),console.log("Carico traduzione base.");try{g.readFile(e,"utf8",(t,r)=>{let n={newest:!0,changed:!0},o=null;if(t)console.log(`Non esiste ancora il file ${e}, tento di crearlo`),o=globalThis.TranslateService.baseLng;else{o=JSON.parse(r);const l=globalThis.TranslateService.baseLng;n=A(o,l)}if(n.changed){const l=n.newest?"Nuovo file,":`(${n.added} agginte, ${n.deleted} rimosse)`;console.log(`Update avvenuto: ${l} salvo.`),g.writeFile(e,JSON.stringify(o,null,2),"utf8",u=>{u?console.error(`Errore durante la scrittura su ${e}`,u):(console.log(`Dati scritti con successo su ${e}`),g.copyFile(e,a,c=>{c||console.log(`Copiato con successo su ${a}`),console.log("END TRANSLATE ---------------------------------------------")}))})}else console.log("Nessun cambiamento."),console.log("END TRANSLATE ---------------------------------------------")})}catch(t){console.error(`Errore l'elaborazione di ${e}, cancellalo`,t);return}}function A(e,a){const t={changed:!1,deleted:0,added:0};for(const r in e)r in a||(delete e[r],t.changed=!0,t.deleted+=1);for(const r in a)r in e||(e[r]=a[r],t.changed=!0,t.added+=1);return t.changed&&(e.__lngVersion__=a.__lngVersion__),t}function L(){return Date.now()}i.babelTranslate=y,i.rollupTranslate=E,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.cjs.map
